@using ReportsManagement.Models;

@{
    ViewBag.Title = "Departamento";
    Layout = "~/Views/Shared/_Layout2Admin.cshtml";
    bool error = (bool)ViewData["error"];
    Department department = new Department();
    DepartmentMongo deptMongo = new DepartmentMongo();
    List<Employee> employees = new List<Employee>();
    List<Employee> allEmployees = new List<Employee>();
}

@if(!error)
{
    department = (Department)ViewData["dept"];
    deptMongo = (DepartmentMongo)ViewData["deptMongo"];
    employees = (List<Employee>)ViewData["employees"];
    allEmployees = (List<Employee>)ViewData["allEmployees"];
}

@section noError 
{
    @if(!error)
    {
        <div class="col-md-8 col-md-offset-2" style="clear:both">
            <div class="collapse" id="addEmployee">
                <div class="col-md-12" >
                    <div class="panel-body">
                        <form class="form-horizontal" method="POST" action="addEmployeeTeam" id="formAdd">
                            <!-- Input oculto para enviar el id del departamento en el POST -->
                            <input type="hidden" class="form-control" value="@department.Deptid" name="idTeam" />
                            <!-- Input oculto para enviar la procedencia del POST -->
                            <input type="hidden" class="form-control" value="dept" name="isTeam" />
                            <div class="form-group col-md-10">
                                <label for="select" class="col-md-3 control-label">Nuevo Integrante: </label>
                                <div class="col-md-9">
                                    <select class="form-control" name="idEmp">
                                        @foreach (Employee emp in @allEmployees)
                                        {
                                            if (emp.TeamId == 33)
                                            {
                                                continue;
                                            }
                                            bool agregate = true;
                                            if (emp.TeamId == department.Deptid)
                                            {
                                                agregate = false;    
                                            }
                                            if (agregate)
                                            {
                                                <option value="@emp.Id">@Html.DisplayFor(modelItem => emp.Name) -- @Html.DisplayFor(modelItem => emp.Email)</option>
                                            }
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-success" onclick="confirmForm('formAdd');">Agregar</button>
                                </div>
                            </div>
                        </form>
                        <hr />
                    </div>
                </div>
            </div>
        </div>
        
        <article>
            <div class="row col-md-8 col-md-offset-2">
                <div class="col-md-10">
                    <div class="col-md-12">
                        <h2>Descripción del departamento @Html.DisplayFor(modelItem => department.DeptName):</h2>
                    </div>
                    <div class="col-md-10 col-md-offset-2" style="clear: both;">
                        <p>Nombre Equipo: <b><i>@Html.DisplayFor(modelItem => department.DeptName)</i></b></p>
                        <p>Nombre Responsable: <b><i>@Html.DisplayFor(modelItem => deptMongo.Name[0])</i></b></p>
                    </div>
                </div>
                <div class="col-md-2">
                    <button id="add" type="button" onclick="showHideForm();" class="btn btn-success" role="button" data-toggle="collapse" href="#addEmployee" aria-expanded="false" aria-controls="collapseExample" style="float:right; margin-top:20px">
                        <span id="spanAdd" itemid="show" class="glyphicon glyphicon-plus" aria-hidden="true" data-toggle="tooltip" data-placement="left" title="Agregar nuevo empleado"></span>
                    </button>
                </div>
            </div>
            <div class="table-responsive col-md-8 col-md-offset-2" style="clear:both">
                <table class="table table-hover display responsive nowrap" id="date-table" cellspacing="0" width="100%">
                    <thead>
                    <tr>
                        <th>Integrante</th>
                        <th>Correo</th>
                        <th>Acciones</th>
                    </tr>
                    </thead>
                    <tbody>
                        @foreach (var emp in employees)
                        {
                            <tr>
                                <td>@Html.DisplayFor(modelItem => emp.Name)</td>
                                <td>@Html.DisplayFor(modelItem => emp.Email)</td>
                                <td>
                                    @Html.ActionLink("Editar Empleado", "editEmployee", new { id = emp.Id, isTeam = 2}, new { @class = "btn btn-success btn-xs" })
                                    @Html.ActionLink("Eliminar Empleado", "deleteEmployee", new { id = emp.Id, isTeam = 2, idTeam = department.Deptid }, new { @class = "btn btn-danger btn-xs", @id = emp.Id, @style = "display: none;" })
                                    <button class="btn btn-danger btn-xs" onclick="validatePassword('Por favor ingrese su contraseña.', @emp.Id);">Eliminar Empleado</button>
                                    @Html.ActionLink("Asistencia", "attendance", new { id = emp.Id }, new { @class = "btn btn-primary btn-xs" })
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </article>        
    }
}

@section scripts
{
    <script>
        
    </script>
}
